---
import Layout from '../../layouts/Layout.astro'
import ChallengeDetail from '../../components/ChallengeDetail'
import { parseAllChallenges } from '../../lib/parseChallenges'
import { marked } from 'marked'
import { categories } from '../../data/challenges'

export function getStaticPaths() {
  const challenges = parseAllChallenges()

  return challenges.map((challenge, index) => ({
    params: { id: challenge.id },
    props: {
      challenge,
      prevId: index > 0 ? challenges[index - 1].id : null,
      nextId: index < challenges.length - 1 ? challenges[index + 1].id : null,
    },
  }))
}

const { challenge, prevId, nextId } = Astro.props

const contentHtml = marked.parse(challenge.content) as string

// Find category info
const prefix = challenge.id.replace(/\d+/, '')
const category = categories.find(c => c.prefix === prefix)
const categoryName = category?.name ?? ''
const categoryIcon = category?.icon ?? ''
---

<Layout title={`${challenge.id}: ${challenge.title} â€” VibeCoder Learn`}>
  <div class="max-w-5xl mx-auto px-6 sm:px-8 py-8 sm:py-12">
    <ChallengeDetail
      client:load
      id={challenge.id}
      title={challenge.title}
      time={challenge.time}
      difficulty={challenge.difficulty}
      repeatable={challenge.repeatable}
      contentHtml={contentHtml}
      criteria={challenge.criteria}
      learnings={challenge.learnings}
      prevId={prevId}
      nextId={nextId}
      categoryName={categoryName}
      categoryIcon={categoryIcon}
      locale="zh"
    />
  </div>
</Layout>
