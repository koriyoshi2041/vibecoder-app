---
import type { Locale } from '../i18n'
import { t, getLocalizedPath } from '../i18n'

interface Props {
  locale?: Locale
}

const { locale = 'zh' } = Astro.props
const currentPath = Astro.url.pathname

const prefix = locale === 'en' ? '/en' : ''
const links = [
  { href: prefix || '/', label: t('nav.home', locale) },
  { href: `${prefix}/path`, label: t('nav.path', locale) },
  { href: `${prefix}/challenges`, label: t('nav.challenges', locale) },
  { href: `${prefix}/projects`, label: t('nav.projects', locale) },
]

const otherLocale: Locale = locale === 'en' ? 'zh' : 'en'
const cleanPath = currentPath.replace(/^\/en/, '') || '/'
const switchUrl = otherLocale === 'en' ? getLocalizedPath(cleanPath, 'en') : cleanPath
const switchLabel = otherLocale === 'en' ? 'EN' : '中文'

function isActive(linkHref: string): boolean {
  if (linkHref === '/' || linkHref === '/en') {
    return currentPath === '/' || currentPath === '/en' || currentPath === '/en/'
  }
  return currentPath.startsWith(linkHref)
}
---

<nav id="main-nav" class="fixed top-0 w-full z-50">
  <div class="max-w-7xl mx-auto px-6 sm:px-8">
    <div class="flex items-center justify-between h-16 sm:h-20">
      <!-- Logo: Seal-style -->
      <a href={prefix || '/'} class="flex items-center gap-3 group">
        <span class="seal-logo inline-flex items-center justify-center w-9 h-9 border-2 border-rust rounded-sm font-serif text-sm font-bold text-rust transform -rotate-3">
          VC
        </span>
        <span class="text-sm font-medium text-charcoal hidden sm:inline tracking-wide">
          VibeCoder Learn
        </span>
      </a>

      <!-- Links -->
      <div class="flex items-center gap-0.5 sm:gap-1">
        {links.map(link => (
          <a
            href={link.href}
            class:list={[
              'nav-link px-3 py-1.5 text-sm transition-colors rounded-sm',
              isActive(link.href)
                ? 'text-rust font-medium'
                : 'text-charcoal-light hover:text-charcoal'
            ]}
            data-active={isActive(link.href) ? '' : undefined}
          >
            {link.label}
          </a>
        ))}

        <!-- Divider -->
        <span class="w-px h-4 bg-light-beige mx-2 hidden sm:block" />

        <!-- Language Toggle -->
        <a
          href={switchUrl}
          class="px-2.5 py-1 text-xs font-mono text-warm-gray hover:text-rust transition-colors"
        >
          {switchLabel}
        </a>
      </div>
    </div>
  </div>
</nav>
